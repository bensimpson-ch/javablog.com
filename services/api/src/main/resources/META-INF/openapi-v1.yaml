openapi: 3.0.3
info:
  title: JavaBlog API
  description: Newsletter registration API for JavaBlog.com
  version: 1.0.0

tags:
  - name: token
    description: Authentication token operations
  - name: newsletter
    description: Newsletter subscription operations

paths:
  /v1/token:
    post:
      tags:
        - token
      operationId: generateToken
      summary: Generate a short-lived registration token
      description: Returns a token that must be used when registering for the newsletter
      responses:
        '200':
          description: Token generated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'

  /v1/newsletter:
    post:
      tags:
        - newsletter
      operationId: registerNewsletter
      summary: Register an email for the newsletter
      description: Registers an email address using a valid token from /token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewsletterRegistrationRequest'
      responses:
        '200':
          description: Registration successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NewsletterRegistrationResponse'
        '400':
          description: Invalid request (bad email format or expired/invalid token)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    TokenResponse:
      type: object
      required:
        - token
        - expiresIn
      properties:
        token:
          type: string
          description: Short-lived token for newsletter registration
        expiresIn:
          type: integer
          description: Token validity in seconds

    NewsletterRegistrationRequest:
      type: object
      required:
        - email
        - token
      properties:
        email:
          type: string
          format: email
          description: Email address to register
        token:
          type: string
          description: Token obtained from /token endpoint

    NewsletterRegistrationResponse:
      type: object
      required:
        - message
      properties:
        message:
          type: string
          description: Confirmation message

    ErrorResponse:
      type: object
      required:
        - error
      properties:
        error:
          type: string
          description: Error message
